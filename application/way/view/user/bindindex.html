<!DOCTYPE html>
<html>
<head>
<meta
	name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"
/>
<meta
	http-equiv="X-UA-Compatible"
	content="IE=edge,chrome=1"
/>
<!-- 优先使用 IE 最新版本和 Chrome -->
<meta
	name="renderer"
	content="webkit"
>
<!-- 360浏览器切换极速模式 -->
<meta
	http-equiv="Cache-Control"
	content="no-siteapp"
/>
<!-- 禁止百度手机转码 -->
<meta
	http-equiv="Content-Type"
	content="text/html; charset=utf-8"
/>
<title></title>
<base href="__STATIC__/" />
<link
	href="__CSS__/style.css"
	type="text/css"
	rel="stylesheet"
/>
<link
	href="__CSS__/reset.css"
	type="text/css"
	rel="stylesheet"
/>
<link
	rel="stylesheet"
	href="__CSS__/jquery.mloading.css"
>
<link
	rel="stylesheet"
	href="__CSS__/validationEngine.jquery.css"
>


<script
	src="__JS__/jquery-1.8.3.min.js"
	type="text/javascript"
></script>
<script src="__JS__/texiao1.js"></script>
<script src="__JS__/jquery.mloading.js"></script>


<script src="__JS__/zepto.min.js"></script>
<script src="__JS__/picker.js"></script>
<link
	rel="stylesheet"
	href="__CSS__/weui2.css"
>

<script src="__JS__/angularjs.js"></script>
<script
	type="text/javascript"
	src="__JS__/jsencrypt.min.js"
></script>

<style>
.formErrorContent {
	color: #000000 !important;
}

.kuan {
	margin-bottom: 10rm !important;
}
</style>
</head>
<body>



	<form
		class="kscx_top"
		id="form_id"
		method="post"
		action="bind"
		ng-app="myApp"
		ng-controller="myCtrl"
	>
		<div class="zhuce clearfix">
			<span ng-bind="form_name"></span>
		</div>
		<ul>
			<li class="xm_l1">车主姓名<span><input
					name="username"
					class="weui_input ws_ibj"
					type="text"
					placeholder="请输入车主姓名"
					maxlength="5"
					id="username"
				/></span></li>
			<li>身份证号<span><input
					id="identity_card"
					class=" weui_input ws_ibj"
					name="identity_card"
					type="text"
					placeholder="请输入省份证号"
					maxlength="18"
				/></span></li>
			<li>手机号码<span><input
					id="phone"
					class="weui_input ws_ibj"
					name="phone"
					type="text"
					pattern="[0-9]*"
					placeholder="请输入手机号码"
					maxlength="11"
				/></span></li>
			<li>车牌号<span><input
					id="car_number"
					class="weui_input ws_ibj"
					type="text"
					name="car_number"
					placeholder="请输入车牌号 示例吉A*****"
				/></span></li>
			<li>车型<span><select
					id="car_type_id"
					class="weui_input ws_ibj gais"
					name="car_type_id"
				>
						<option value="0">请选择车型</option>
						<option
							value="{{ x.uni_id }}"
							ng-selected="number123==x.uni_id"
							ng-repeat="x in names"
							ng-bind="x.name"
						></option>

				</select></span></li>
			<li>发动机号<span><input
					id="engine"
					class="weui_input ws_ibj"
					name="engine"
					type="text"
					placeholder="请输入发动机号"
				/></span></li>
			<li>颜色<span><select
					id="car_color"
					class="weui_input ws_ibj gais"
					name="car_color"
				>
						<option value="0">请选择颜色</option>
						<option
							value="{{ x.id }}"
							ng-selected="form_car_color==x.id"
							ng-repeat="x in repeat_car_color"
							ng-bind="x.value"
						></option>

				</select></span></li>

			<li>车辆注册时间<span><input
					id="reg_time"
					class="weui_input ws_ibj"
					type="text"
					name="reg_time"
					placeholder="请输入车辆注册时间"
				/></span></li>

			<li>车架号<span><input
					id="chassis_number"
					class="weui_input ws_ibj"
					type="text"
					name="chassis_number"
					placeholder="请输入车架号"
				/></span></li>

			<li class="cl_l1">品牌<span><input
					id="brand"
					name="brand"
					class="weui_input ws_ibj"
					type="text"
					placeholder="请输出车辆品牌"
				/></span></li>


			<li class="cl_l1">身份证正面<span><input
					id="identity_image0"
					name="identity_image0"
					class="weui_input ws_ibj"
					type="file"
					placeholder="请上传身份证图片正面"
				/></span></li>
				
			<li class="cl_l1">身份证反面<span><input
					id="identity_image1"
					name="identity_image1"
					class="weui_input ws_ibj"
					type="file"
					placeholder="请上传身份证图片反面"
				/></span></li>
			<li class="cl_l1">行驶证<span><input
					id="driving_license_image"
					name="driving_license_image"
					class="weui_input ws_ibj"
					type="file"
					placeholder="请上传身份证图片正面"
				/></span></li>




		</ul>
		<p class="clbd_p1">完善车辆信息，点击下面按钮扫描证件</p>
		<div class="sb_logo">
			<a href="#"><img
				src="images/sfz_logo_03.png"
				class="sb_s1"
			></a> <a href="#"> <img
				src="images/jsz_sb_03.png"
				class="sb_s2"
			>

			</a>


		</div>
		<div class="ws_dj1">
			<label><input
				type="checkbox"
				id="yes"
				name="_agree"
			/></label><span>我已阅读并同意《吉林省高速缴费平台用户缴费协议》</span>
			<div
				class="kuan"
				style="margin-bottom: 0.546875rem;"
			>
				<input
					class="li_input_hidden"
					type="hidden"
					name="id"
					value="0"
				/>
				<button
					id="zhuce"
					class="submit ws_qq"
					type="submit"
					disabled="true"
				>提交</button>
			</div>
		</div>

	</form>

	<div
		class="formErrorContent fengmian"
		id="y1"
	>
		<div
			class="tishi"
			id="y2"
		>
			<p class="y2_1">数据加载中。。。</p>
			<a
				class="btnok"
				href="JAVASCRIPT:;"
			>确定</a>
		</div>
	</div>

	<div
		id="rsa_public_key"
		style="display: none;"
	>{$rsa_public_key}</div>

	<script type="text/javascript">
var app = angular.module('myApp', []);
</script>
<script  type="text/javascript" src="__JS__/way_user_index.js"></script>

	<script>

var form_data = {$form};
if(typeof form_data.car_type_id =='undefined'){
	form_data.car_type_id =0;
}
if(typeof form_data.car_color =='undefined'){
	form_data.car_color = 0;
}

app.controller('myCtrl', function($scope,$http) {
    $scope.form_name = "绑定车辆";
    $scope.number123 = form_data.car_type_id;
    $scope.form_car_color = form_data.car_color;
    
    $http.get('{:url('way/user/getCarTypeJson')}').success(function (response) { 
 	   $scope.names = response.records;
 	});
   
    $http.get('{:url('way/user/getCarColorJson')}').success(function (response) { 
 	   $scope.repeat_car_color = response.records;
 	});
   
});

var encrypt = new JSEncrypt();
var public_key=$("#rsa_public_key").html();

encrypt.setPublicKey(public_key);
//var data = encrypt.encrypt("123456789");

function getIsUploadImage(sel_id){
	if(typeof $("#"+sel_id)[0].files[0] == 'undefined' ){
		return encrypt.encrypt('');
	}else{
		return $("#"+sel_id)[0].files[0];
	}
}

$(function() {
	
	$("input[name='reg_time']").datetimePicker({title:"车辆注册时间",m:1});  //年月日
	hide_btn();
	
	$("li input,.li_input_hidden").each(function(){
		if(typeof form_data[$(this).attr('name')] != 'undefined' && $(this).attr('type') != 'file' ){
			$(this).val( form_data[$(this).attr('name')] );
		}
	})
	
	
	var is_submit = false;
	var formData = {};
	var th_input={};
	$("#form_id").submit(function(){
		
		
		if(! $("#yes").prop("checked") ){
			show("请勾选 吉林省高速缴费平台用户缴费协议");
			return false;
		}
		
		if(is_submit){
			return false;
		}
		is_submit = true;
		
		formData = new FormData();
		
		$("#form_id").find("input,select,textarea").each(function(){
			th_input = $(this);
			if(th_input.attr("type") == "file"){
				return ;
			}
			formData.append( th_input.attr("name") , encrypt.encrypt (th_input.val() ) );
		});
		
		formData.append("identity_image0", getIsUploadImage("identity_image0") );
		formData.append("identity_image1", getIsUploadImage("identity_image1") );
		formData.append("driving_license_image", getIsUploadImage("driving_license_image") );
	
		formData.append("_method" , '{$form_method}' );

		$.ajax({
			url:"{$form_url}",
			//data:$("#form_id").serialize()+'&_ajax=1&_method={$form_method}',
			data:formData,
			dataType:"json",
			"type":"post",
			processData : false, 
			contentType : false,
			beforeSend:function(){
				show_loading();	
			},
			success:function(data){
				hide();
				if(0 === data.errcode){
					show(data.html);
					$("#y2 .btnok").click(function(){
						location.href=data.view_url;
					});
				}else{
					show(data.html);
				}
			},
			complete:function(){
				is_submit = false;
			},
			error:function(data){
				hide();
				//alert(JSON.stringify(data))
				show("系统错误请重试，或联系客服人员");
			}
		});
		
		return false;
	});
	
});

	
	
</script>















	<script>
function Bind(){
	this.isIPHONE = navigator.userAgent.toUpperCase().indexOf('IPHONE')!= -1;
	
}





    /*判断是否为苹果*/

    var isIPHONE = navigator.userAgent.toUpperCase().indexOf('IPHONE')!= -1;



    // 元素失去焦点隐藏iphone的软键盘

    function objBlur(id,time){

        if(typeof id != 'string') throw new Error('objBlur()参数错误');

        var obj = document.getElementById(id),

        time = time || 0,

        docTouchend = function(event){

            if(event.target!= obj){

                setTimeout(function(){

                    obj.blur();

                    document.removeEventListener('touchend', docTouchend,false);

                },time);

            }

        };

        if(obj){

            obj.addEventListener('focus', function(){

                document.addEventListener('touchend', docTouchend,false);

            },false);

        }else{

            throw new Error('objBlur()没有找到元素');

        }

    }



    if(isIPHONE){
        new objBlur('username');
        new objBlur('identity_card');
        new objBlur('phone');
        new objBlur('car_number');
        new objBlur('car_type_id');
        new objBlur('engine');
        new objBlur('car_color');
        new objBlur('reg_time');
        new objBlur('chassis_number');
        new objBlur('brand');
    }
    
</script>


</body>
</html>